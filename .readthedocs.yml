# .readthedocs.yml
# Read the Docs configuration file
# See https://docs.readthedocs.io/en/stable/config-file/v2.html for details

version: 2

sphinx:
  configuration: docs/conf.py

formats:
  - htmlzip

build:
  os: ubuntu-24.04
  tools:
    python: "3.12"
  jobs:
    pre_create_environment:
      # Install uv
      - asdf plugin add uv
      - asdf install uv latest
      - asdf global uv latest
    create_environment:
      # Create virtual environment with uv
      - uv venv $READTHEDOCS_VIRTUALENV_PATH
    install:
      # Install jax-md and doc dependencies with uv
      - UV_PROJECT_ENVIRONMENT=$READTHEDOCS_VIRTUALENV_PATH uv sync --group docs
      - uv run python -m ipykernel install --user --name python3
    pre_build:
      - cp -r examples docs/
      - uv run jupytext --set-formats "py:percent,ipynb" docs/examples/*.py
      - uv run jupytext --set-kernel python3 docs/examples/*.py
      - uv run jupytext --to notebook --execute docs/examples/*.py
      - rm docs/examples/*.py
    post_build:
      - mkdir -p $READTHEDOCS_OUTPUT/html/notebooks
      - cp docs/examples/*.ipynb $READTHEDOCS_OUTPUT/html/notebooks/
